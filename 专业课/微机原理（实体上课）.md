---
tags: 大三上 专业课
---
# 前言
 
开课时间：2022.08.30-
关联笔记：[2020 西电计算机组成与体系结构 车向泉](../自学内容/计算机/计算机组成原理/2020%20西电计算机组成与体系结构%20车向泉.md) [微机原理（西电）](微机原理（西电）.md)


# 课程笔记

## 第一章. 微型计算机的基础与发展概论

### 1. 计算机中的数制和码值

1. 数制
- 十进制与二进制互化，二进制与十六进制互化

2. 码制
- 原码，反码，补码。
	- 原码：符号位+真值
		- 无右码(-127,+127)，且存在+0和-0
	- 反码
		- 与原码性质大体相同。
	- 补码
		- 解决0问题，（-128，+127），且无+0/-0之分。
	- **不涉及到浮点数内容**。

### 2. 计算机的基本结构

1. 冯诺依曼结构
- 取指---->译码->执行---->再取指
2. 指令系统与机器码
3. 硬件/软件/OS

### 3. 微型计算机的结构和系统

1. 结构框图
![|600](assets/Pasted%20image%2020220830093008.png)

### 4. 计算机的发展


## 第二章. 微处理器的结构和工作方式

### 2.1  8086CPU的内部结构和存储器组织

1. 8086CPU的内部结构与工作过程
![|700](../Excalidraw/Drawing%202022-09-01%2010.34.26.excalidraw)

- ALU：算术逻辑单元
- EU：执行单元
- 8086：数据总线16位，地址总线20位
- 物理地址：地址总线的实际地址（直接译码结果）。
- 指令队列：从串行执行->并行执行。
- 整体过程图（抽象）如下：
![|150](../Excalidraw/Drawing%202022-09-01%2010.46.38.excalidraw.md)
2. 8086CPU内部寄存器

1) 数据寄存器
- AX ——累加器（AH+AL）
	- 很多指令默认为AX
- BX——基址寄存器
- CX——计数寄存器（CH+CL）
	- 也可以做计数器
- DX——数据寄存器
	- 在乘除法时有默认应用
	- 对于I/O设备时，设备编号默认放入DX中

2) 指针寄存器
- SP——堆栈指针
- BP——基址指针

3) 变址寄存器
- SI——源变址寄存器
- DI——目的变址寄存器

4) 段寄存器（物理地址=段地址\*16H（左移四位）+偏移地址   如：CS\*16+IP）
- CS——代码段寄存器（Code）
- DS——数据段寄存器（Data）
- SS——堆栈段寄存器（Stack）
- ES——附加段寄存器（其与DI配对）

5) 指令指针
- IP——程序指针（CS\*16+IP）
	- 执行一次取址操作后，IP=IP+1

6) 标志寄存器（FLAG）
![|600](assets/Pasted%20image%2020220901112914.png)
- 状态标志（由ALU的运算结果确定，不受人为干预）
	- CF——进位标志
	- PF——**奇偶校验标志**（只看第八位）
	- AF——辅助进位标志（**只在BCD码运算时启用，且只在AL处（在三四位处）检验**）
	- ZF——零标志（最常用）
	- SF——符号标志（负标志）
	- OF——溢出标志（有符号数运算时考虑）
- 控制标志（不受ALU影响）
	- DF——方向标志（只跟SI，DI关联 递增/递减）
	- IF——中断标志（屏蔽中断）
	- TF——陷阱标志（设置断点，单步调试使用）

3. 8086CPU的存储器组织（对存储器的管理）

1) 分段结构
- 物理地址=段地址\*16H（左移四位）+偏移地址
- 采用其原因：1. 当时收到限制    2. 不同计算机保持内容一致（绝对地址无法保证兼容性）

### 2.2 8086CPU的引脚功能与8086的工作模式

- 地址总线为单方向，主要是CPU向外发送的。
- 引脚接地：电路的抗干扰性能提高。

- 计算机的最小组成
	- 存储器的分段与分体结构
![|600](assets/Pasted%20image%2020220913080446.png)

- BHE非：高地址有效
- 74LS373->接过去，为两个512kb。
- 74LS245（数据总线缓冲器）->DIR（控制方向）（数据是双向的）
- 堆栈区以字为单位，取偶地址。

- CPU的时序
	- T1负责地址，T2-T4负责数据操作



## 第三章 8086的寻址方式与指令系统

### 1. 8086的寻址方式

- 立即数寻址
- 寄存器寻址
- 存储器寻址
	- 直接寻址
	- 间接寻址
	- 相对寻址
	- 基址变址寻址
	- 相对基址变址寻址
- 其他寻址


### 2. 指令机器码（略过）
- 机器码的编码规则


### 3. 指令系统

3.3.1  数据传送指令

1) 通用数据传送指令

- MOV 传送指令
	- 指令格式：MOV  目的，源
	- 指令功能：目的操作数←源操作数
	- CS、IP不参与传送类指令，其决定程序执行的下一条指令。（换句话说，**其不能作为目的操作数**）
	- 同样，**立即数也不能作为目的操作数**。
	- 寄存器之间也可以传送，类型需要一致。**单挑指令不允许存储器与存储器之间进行数据传送**。
	- 立即数作为源操作数传送给存储器时，**需要添加修饰符**说明数据类型。
![|600](assets/Pasted%20image%2020220913082920.png)

- 堆栈操作
	- 所有指令都是字操作，执行对齐模式，保证均为偶地址。
	- 进栈指令 PUSH (Push  Word  onto  Stack)
		- 指令格式： PUSH   源
		- 指令功能： 将源操作数推入堆栈
		- 执行PUSH操作后，使SP←SP-2，再把源操作数压入SP指示的位置上。
		- 例：PUSH AX的操作过程： 
			- 1. SP ← SP - 2
			- 2. ( SP )← AX
	- 出栈指令 POP (Pop  Word  off  Stack)
		- 指令格式： POP    目的
		- 指令功能：把当前SP所指向的一个字送到目的操作数中            
		- 每执行一次出栈操作，SP←SP+2，SP向高地址方向移动，指向新的栈顶。
		- 例：POP CX的操作过程：
			- 1. CX← (SP)
			- 2. SP ← SP + 2

- 交换指令 XCHG  (Exchange)
	- 指令格式： XCHG	目的，源
	- 指令功能： 源操作数和目的操作数相交换
	- 交换可以在寄存器之间、寄存器与存储器之间进行，但**段寄存器不能作为操作数**，也不能直接交换两个存储单元中的内容。

- 表转换指令 XLAT (Table Lookup-Translation)
	- 指令格式： 
		- XLAT 	转换表     ；“转换表”为表格首地址
		- 或    XLAT	    	      ；“转换表”可省略不写
	- 指令功能： 将1个字节从一种代码转换成另一种代码
	- 使用XLAT指令前，应建立一个表格，最多256个字节，且置：BX←转换表始址，AL← 表头地址到要找的某项间的位移量。
	- 指令执行时，根据位移量从表中查到转换后的代码值，送入AL中。
	- 例：七段数码管
```asm
TABEL  DB	40H，79H，24H，30H，19H；七段码表格
		     DB	12H，02H，78H，00H，18H
		        …
MOV	  AL，5			；AL←数字5的位移量
MOV	  BX，OFFSET  TABLE	；BX←表格首地址
XLAT  TABLE			；查表得AL=12H
```

2) 输入输出指令

- IN 输入指令 
	- 指令格式：	
		- IN  AL，端口地址	；AL←从8位端口读入1字节。 或  IN  AX，端口地址	；AX←从16位端口读入1个字
		- IN  AL，DX		；端口地址存放在DX中。  或  IN  AX，DX
	- 超过8位的数据，不允许直接写入。需要先MOV去DX，再用IN读取。例子如下：
```Asm
MOV  DX，310H	   ；端口地址310H先送入DX
IN	   AL，DX	   ；AL←310H端口内容
```

- OUT 输出指令 (Output)
	- 指令格式：
		- OUT   端口地址，AL	；8位端口←AL内容    或    OUT   端口地址，AX	；16位端口←AX内容；
		- OUT   DX，AL		；DX=端口地址    或    OUT   DX，AX
	- 超过8位数据的处理与IN一致。
```Asm
MOV	  DX，300H	；DX指向16位端口
OUT	  DX，AX		；300H端口←AL内容
					；301H端口←AH内容
```

3) 地址目标传送指令 (Address Object Transfers)

- LEA 取有效地址指令 (Load Effective Address)
	- 指令格式： LEA	 目的（R/M，一般为R），源（M）
	- 指令功能： 取源操作数地址的偏移量，送到目的操作数（取的不是数值，而是偏移地址）
		- 例：设：SI=1000H，DS=5000H，(51000H)=1234H，指令执行结果如下：
			- LEA	BX，［SI］		      ；[SI]的偏移地址为1000H，BX←1000H
			- MOV	BX，［SI］	      ；偏移地址为1000 H单元的内容为1234H，指令执行后，BX←1234H 
		- 例：下面两条指令是等价的，它们都取TABLE的偏移地址，送到BX中。
			- LEA	BX，TABLE
			- MOV	BX，OFFSET  TABLE

- LDS 将双字指针送到寄存器和DS指令  (Load Pointer using DS)
	- 指令格式： LDS	目的，源（M）
	- 指令功能： 从源操作数指定的存储单元中，取出1个4字节地址指针，送进目的寄存器DS和指令中指定的目的寄存器中。
	- 例 设：DS=1200H，(12450H)=F346H，(12452H)=0A90H。执行指令：LDS    SI，［450H］		
		- 结果：存储单元前2字节内容为F346H ，SI←F346H
		- 后2字节内容为0A90H ，DS←0A90H

- LES 将双字指针送到寄存器和ES指令  (Load Pointer using ES)
	- 指令格式： LES	目的，源（M）
	- 指令功能：与LDS指令的操作基本相同，但段寄存器为 ES，目的操作数常用DI。
	- 例：设DS=0100H，BX=0020H，(01020H)=0300H，(01022H)=0500H
		- LES	 DI，［BX］		；存储单元前2字节内容为0300H ，SI←0300H，后2字节内容为0500H ，ES←0500H

4) 标志传送指令(Flag Transfers)

- LAHF 标志送到AH指令 （Load AH from Flags)
	- 指令格式： LAHF
	- 指令功能： 把标志寄存器的SF、ZF、AF、PF和CF传送到AH寄存器的相应位。


![|600](assets/Pasted%20image%2020220913093934.png)

- SAHF AH送标志寄存器 (Store AH into Flags)
	- 指令格式： SAHF
	- 指令功能： 把AH内容存入标志寄存器。指令功能与LAHF 的操作相反。

- PUSHF 标志入栈指令(Push Flags onto Stack)
	- 指令格式： PUSHF
	- 指令功能： 把整个标志寄存器的内容推入堆栈，并使SP←SP-2。

- POPF 标志出栈指令 (Pop Flags off Stack)
	- 指令格式： POPF
	- 指令功能： 把SP所指的一个字，传送给标志寄存器FLAGS，并使SP←SP+2。

5) 传送类指令的特点
- **除了SAHF，POPF之外**，原则上不影响FLAGS（未进行ALU运算）。


3.3.2  算术运算指令



3.3.3  逻辑运算和移位指令

3.3.4  字符串处理指令

3.3.5  控制转移指令

3.3.6  处理器控制指令

















# 课程评价
