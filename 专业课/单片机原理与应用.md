---
tags: 专业课 大三上
---
# 前言
 
课程链接：

# 课程笔记

## 第一章 概论

课程内容：
![|600](assets/Pasted%20image%2020220831081643.png)
- 时钟的基本概念：
	- 时钟是单片机的心脏，每跳动一下，整个单片机的各个电路就同步地动作一下，要求稳定而准确。
- 启动单片机后，指令执行顺序（**M3为三级指令流水线**）：
		- ![|500](assets/Pasted%20image%2020220831082921.png)
- CPU时序：
	- 单片机内的取指、分析、执行等各种操作都是在一系列时 钟脉冲控制下进行的，而各脉冲在时间上是有先后顺序的，这 种顺序就称为时序。
- 执令周期：即从取指到执行完，所需时间。不同机器指令周期不一样；即使相同机器，不同的指令其指令周期也不一样。
- 机器周期：机器的基本操作周期。一个指令周期含若主机器周期（单、双、四周期）。
- 时钟周期：又称振荡周期，由振荡时钟产生，时钟周期Tosc= 1/fosc。
- **CM3大多数指令是单周期**。


### 1.1 Arm简介

-  CISC与RISC
- ARM的各种构架版本
	- ARMV7：采用了Thunmb-2技术，定义了3种独立的内核:（Cortex） PPT 第一章21
		- A：面向应用的微处理器，针对复杂操作系统和应用程序设计；
		- R：针对实时系统的嵌入式处理器
		- M：针对成本敏感应用优化的深度嵌入式处理器
- ARM的种类与命名规则


### 1.2 Cortex-m3简介

- Cortex-M3一32位处理器内核，哈弗体系结构
	- 32 位内部数据路径， 32 位寄存器， 32 位存储器接口
- Cortex-M3一支持小端格式和大端格式的数据存储。
	- 小端格式：低字节字数据存放在低地址，商字节字数据存放在商地址存储器中
	- 大端格式：与小端格式相反
- 一般地，**CM3采用小端格式**
- Cortex-M3一为应对复杂应用需要更多的存储系统功能，提供了一个可选的MPU，在需要的情况下可以使用外部的cache。
- Cortex-M3一内部附加了很多调试组件，可在硬件水平上支持调试操作，如指令断点，数据观察点等。 为支持更高级 的调试，还有增加了指令跟踪、 多种类型的调试接口等可选 组件。
- CM3的结构：
![|600](assets/Pasted%20image%2020220831083518.png)
- CM3的特点：
	- 集成了内核和高级系统外设的分级处理器
- Cortex-M3内核
	- 哈佛体系结构
	- 拥有分支预测功能的三级流水线
	- Thumb®-2指令集和传统的Thumb指令集
	- 带有硬件除法和单信号周期乘法的ALU 
	- 支持两种状态：Thumb和调试状态
- 哈佛结构
	- 指令总线和数据总线分离，允许井行地取指和数据存储。
- Thumb-2指令集拥有32位的性能和16位的代码密度
- Cortex-M3核内部集成了嵌入式高速中断控制器
	- 低中断响应时间，最低可达6个CPU时钟周期（内部中断）
	- 从低功耗模式被唤醒也只需6个CPU时钟周期
- 具有高集成度
	- 内置式的管理单元减少了对外部器件的需求：
	- 一个主晶振驱动整个系统
	- 一嵌入式的8MHzRC可以被用作主时钟
- 在LQFPlOO封装芯片的基础系统上只需要7个外部无源器件。

- CM3的指令流水线：
![|600](assets/Pasted%20image%2020220831084001.png)

- ARM的指令集
![|600](assets/Pasted%20image%2020220831084249.png)
- CM3的指令集（Thumb2的子集）
	- 支持非对齐数据访问。
	- 支持16位与32位指令。
	- 不向后兼容，支持绝大多数传统Thumb指令。


### 1.3 Stm32简介

- 产品分类与命名规则
- STM32F1 MCU的性能特点
	- 管脚，软件和外设全设备兼容
	- 具有高集成度


## 第二章 ARM Cortex-M3的编程模型

### 2.1 概述

![|500](assets/Pasted%20image%2020220831084636.png)

### 2.2 工作模式与访问权限
### 2.3 工作模式、访问权限的转换

![](assets/Pasted%20image%2020220831085725.png)


**线程模式下为什么不能从用户级权限直接返回到特权级权限？**
- 原因：用户级权限有限
	- 禁止访问系统控制空间(SCS)：包含配置寄存器，调试组件寄存器。
	- 禁止MSR访问特殊功能 寄存器除有APSR例外。
	- 若是以身试法，则以fault伺候
- 方法：在特权级下的代码可以置位CONTROL\[0\]进入用户级，但是用户级下的代码不能通过CONTROL\[0\]回到特权级，一旦进入用户级，返回特权级的唯一途径就是触发一个（软）中断，再用服务例程改写该位，才能在返回到线程模式后拿到特权级。

### 2.4 数据类型与存储器格式

- ARM存储器默认小端格式。
- 小端存储：数据高位存入高职止，数据删立存入低地址

### 2.5 内核寄存器

1. 通用寄存器
![|800](assets/Pasted%20image%2020220831091757.png)
2. 特殊功能寄存器
![|800](assets/Pasted%20image%2020220831091845.png)
![|800](assets/Pasted%20image%2020220831091906.png)
![|800](assets/Pasted%20image%2020220831091929.png)
![|800](assets/Pasted%20image%2020220831091950.png)
3. 三种寄存器的用法
![|800](assets/Pasted%20image%2020220831092004.png)

### 2.6 异常与中断
![|800](assets/Pasted%20image%2020220831092040.png)
1. 常见CM3中异常类型与编号/优先级
![|800](assets/Pasted%20image%2020220831092135.png)

### 2.7 向量表
- 当异常被CM3内核接受，处理器就会执行相应异常处理。 为了决定“处理的入口地址，CM3使用了 向量表查表机制” 。
- 向量表是一个WORD类型的(32位整数）数组，每个下标对应—种异常，该下标元素的值则是该异常处理的入口地址。
- 向量表的存储位置是可以设置的，通过NVIC中的一个重定位寄存器来指出向量表的地址。 
- 在复位后，该寄存器的值为0。 因此，在地址0处必须包含一张向量表，用千初始时的异常分配。


### 2.8 堆栈操作
![|800](assets/Pasted%20image%2020220831093408.png)


### 2.9 复位序列

![|800](assets/Pasted%20image%2020220831093904.png)













# 课程评价
