---
tags: 大三上 专业课 
---
# 前言
 
课程链接：[微机原理 （西安电子科技大学）_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1ZJ411b7Na?spm_id_from=333.999.0.0&vd_source=f6d522f28072721da0e962ed83629041)

关联课程：[微机原理（实体上课）](微机原理（实体上课）.md) [2020 西电计算机组成与体系结构 车向泉](../自学内容/计算机/计算机组成原理/2020%20西电计算机组成与体系结构%20车向泉.md)

# 课程笔记

## 第0章 绪论

### 1. 课程内容安排

- 对应教材第一至十章，前四章为软件部分，后续为硬件部分。
- 物理量->（传感器）->电量（mv）->前端调理电路（电路放大与滤波）->AD变换器（速度，精度）->CPU（8086）（包括存储器）->显示/DA转换器（**此处为接口电路**）->后端调理电路
- CPU->AD变换器（控制命令） CPU->前端调理电路
![|500](assets/Pasted%20image%2020220911161513.png)


### 2. 微型计算机系统组成（硬件子系统）
1. 早期计算机硬件组成
![|500](assets/Pasted%20image%2020220911162043.png)

- ALU+控制器=中央处理器CPU、微处理器
- 信息：控制信息，数据信息，地址信息。
- 总线：用来传输信息的通路。 对应三条信息，有三种总线。
	- 数据总线（DB）
	- 地址总线（AB）
	- 控制总线（CB）

2. 微型计算机硬件组成
- 复用引脚
- 数据总线为双向，地址总线为单向，控制总线为双向。
- CPU的复用引脚经过**系统总线形成电路**作用，转化为**系统（级）总线**（负责驱动各个负载设备）传输信息。
- **系统总线形成电路**不仅解决了引脚复用问题，还解决了总线驱动能力的问题。
- 微处理器引脚构成的总线称为微处理级总线（驱动负载能力较弱）。
![|500](assets/Pasted%20image%2020220911163449.png)

- 存储器：ROM、RAM
	- ROM：掉电后不丢失，存放系统管理程序。（BIOS）     故也称为程序存储器。
	- RAM：掉电后信息丢失，能读能写。                                    故也称为数据存储器。

![|600](assets/Pasted%20image%2020220911164128.png)

- 指令：一组二进制代码。  =>机器语言
![|500](assets/Pasted%20image%2020220911164439.png)

- 任何I/O设备与CPU之间不能直接通讯。需要设计I/O接口电路。
- I/O接口地址：给I/O接口电路分配的地址。
- I/O地址译码电路：确定选择的是哪个I/O接口电路。
![|500](assets/Pasted%20image%2020220911165109.png)


### 3. 存储器
- 存储器按字节组成（8位）
- 每个单元都有其地址码
- 寻址方式越多，汇编语言程序书写越灵活。
- 任意两个相邻的字节单元，可以组成一个字单元。一个字单元分为低字节和高字节。
![|500](assets/Pasted%20image%2020220911170956.png)


## 第一章 数制与码制

### 1. 数制间的相互转换

- 十进制转二进制——权逼近法
- 二进制转十进制——位置加权法
![|500](assets/Pasted%20image%2020220911172915.png)


- 十进制转十六进制——除十六取值法 或 十进制转二进制转十六进制
- 十六进制转十进制

- 在程序设计中 ：
	- 二进制转十进制：除k取余法（k为位数）、比较法
	- 十进制转二进制：


### 2. 二进制数的运算

- +/-  运算更重要
- 寄存器在CPU内部，暂存数据。
	- 8位寄存器（字节型寄存器）
- 处理器状态字寄存器（PSW）=> 标志寄存器 （只要运算，就影响PSW）
	- **PF只看结果的低八位**。目的：实现计算机的串行通信。实现奇校验/偶校验。
	- AF 半进位/半借位（也称为辅助进位/辅助借位，用于BCD数运算）

- 目的操作数：DST（destination），原操作数：SRC（Source）

- 逻辑运算
	- 与     AND  DST，SRC     应用场合：部分位清零，其余位不变。
		- 注意，表示数字最高位必须补0。
	- 或     OR    DST， SRC      应用场合：部分位置1，其余位不变。
	- 异或  XOR DST，SRC      应用场合：部分位取反，其余位不变。
	- 非     NOT DST      （对PSW的状态标志均无影响）


### 3. 有符号数的表示方法与溢出问题

- 无符号数表示范围：n=8： 0-255 （00H-FFH）  n=16：0-65535（0000H-FFFFH）
- 有符号数的表示：机器数表示法（8位数中，后7位作为数值，最高位作为符号位）

1. 原码（+0，-0结果不同，不采用）
2. 补码（求法与计组一致）
- 在计算机中，有符号数均用补码表示。
- 补码的范围：-128-+127    -32767- +32768


3. 补码的运算
- 【X+Y】补=【X】补+【Y】补
- 【X-Y】补=【X】补-【Y】补
- 【X-Y】补=【X】补+【（-Y）】补
	- 减法变成加法：加法器更加简单，提高运算速度且简化ALU电路设计。
- 注意事项：
	- 补码表示的数，运算后结果仍然为补码。（补码的补码是原码）
	- 已知【Y】补，求【（-Y）】补。
		- 从右往左找第一个1，其前位按位取反（变补/求负）

4. 表示BCD数的方法（方法不同，调整也不同）
- 组合BCD数（压缩BCD数）：放在一个字节内
- 分离BCD数：放在两个字节（第一个后面，第二个前面）

- 例如：53+28
- 组合BCD数：01010011B+00101000B=01111011B（错误）
	- 修正：1011 **大于9小于16**，故加6使其进位。 （分别测CF，AF确定加不加6）
```Asm
	MOV AL 53H   ADD AL 28H DAA
```

5. ASCII码
- 0-9  30H-39H
- 'A' - 'F'  41H- 46H
- 'a' - 'f'  61H-66H
- 字符转化数字-> 与OFH或-30H
- 大写字符转化数字 -> -37H
- 小写字符转大写字符 -> -20H/与DFH  （AND AL 0DFH） 或 与5FH（AND AL 5FH）
- 大写字符转小写字符 -> +20H/或20H （OR AL 20H）


## 第二章 8086CPU的结构与功能

### 2.1 微处理器的外部结构

- 外部结构的表现：数量有限的输入输出引脚（构成了微处理器四级总线） （直插与贴片）
- 8086/8088 40个引脚
- 28引脚：M/非IO  高低电平切换 结合WR非和RD非，可以确定当前是在对谁进行读写操作
- 地址总线：A0-A19 CPU用来给外部存储器提供地址，地址空间为2的20次方=1MB
	- 其中 A0-A15给外部IO设备提供地址 地址空间为2的16次方=64KB
- IO端口：就是用来传送一种信息的通道。（使用寄存器设置），一个IO端口（至少）占用一个IO端口地址（简称为端口地址）
![|500](assets/Pasted%20image%2020220920194846.png)

- 统一编址（如MCS-51系列的CPU）
	- 缺点：浪费了存储器地址空间，没专用的IO指令 。
	- 优点：IO驱动程序编写方便灵活。
- 独立编址（如8086）
	- 优点：节约了存储器地址。
	- 缺点：指令相对而言记忆复杂，IO程序设计不灵活。（注意：IO指令间接寻址不打中括号）


### 2.2 微处理器的内部结构

![|500](assets/Pasted%20image%2020220921104023.png)
- ALU
- 工作寄存器
	- 数据寄存器
	- 地址寄存器
- 控制器——中央指挥机关
	- 取指令->指令寄存器（8位）IR->译码，分析
	- 程序计数器（16位）PC
	- 指令译码器（8位）ID
	- 控制逻辑部件
	- 堆栈：由先进后出（FILO）原则组织的一段存储器区域。
		- 对8086CPU而言，堆栈必须按字操作。
		- PUSH（1. SP=SP-2   2. 压入字  SP指入的位置为栈顶，其是活动的。栈底是固定的。）    （建议留出百分之30的富余量）与POP
- I/O控制逻辑
![|500](assets/Pasted%20image%2020220920200659.png)
- 这种CPU执行效率不高

### 2.3 8086/8088CPU的内部结构

- 内部结构图如下：

![|500](assets/Pasted%20image%2020220925140742.png)


- BIU（总线接口单元）
	- CS（Code Segment），ES，SS，DS（Stack Segment），IP 寄存器  
	- 地址产生与总线控制（地址为段地址+偏移地址）
	- 指令队列寄存器（6个字节的指令队列）
	- 主要功能：从外部存储器中取指令，并将取回的指令放入指令队列中。


- EU（执行单元）
	- 主要负责从指令队列中获取指令（先进先出FIFO），并对该指令加以执行。
	- 包括通用寄存器（组成了汇编语言程序设计的编程逻辑），ALU，PSW等

- 8086中取指令操作与执行指令操作并行执行，CPU工作效率大大提高，也大大提高了总线的利用率。
	- BIU取指令休息的时间：指令取满或EU需要利用总线
![](assets/Pasted%20image%2020220925141514.png)


### 2.4 8086CPU的寄存器组织

- 共有14个16位的寄存器
	- 通用寄存器（EU内部）（8个）
		- 数据寄存器（16位）
			- AX：累加器  （AH/AL）
			- BX：基址寄存器（段地址=>默认操作数据段） （BH/BL）
			- CX：计数器（CH/CL）
			- DX：数据寄存器，IO地址寄存器（DH/DL）
		- 地址指针（2个）与变址寄存器（2个）（16位）（**除了BP其他都默认为DS段**）
			- SP：堆栈指针寄存器
			- BP：地址指针寄存器（段地址=>**默认操作堆栈段**，需要操作其他段时需要加段超越前缀）
			- SI：源变址寄存器
			- DI：目的变址寄存器
	- 段寄存器（4个） （注意 用到时，除CS外，都需要先进行初始化）
		- CS：代码段寄存器（**用户不能给CS写，不能做目的操作数，用操作系统为其初始化**）
		- DS：数据段寄存器
		- ES：附加数据段寄存器
		- SS：堆栈段寄存器
	- 控制寄存器（2个）
		- IP：指令指针寄存器（16位）（一般等效于程序计数器PC）
		- PSW：处理器状态字寄存器
			- ![|500](assets/Pasted%20image%2020220925143239.png)
			- 有用的只有9位：反映的是ALU运算后结果的状态。（**没有运算的指令不会影响标志**）
				- 状态标志（6位）：ZF，CF，PF，OF，SF，AF。
				- 控制标志（3位）：用来控制CPU的运行状态
					- DF：方向控制标志（控制字符串操作SI和DI的方向）  （CLD； DF=0  STD；DF=1）
					- IF：中断允许标志（内部的不能屏蔽，只有外部中断可屏蔽）=>NMI引脚和INTR引脚（17，18）  （CLI；IF=0  STI；IF=1）
					- TF：陷阱（单步）标志 （如DEBUG） （没有清0置1的指令，需要执行OR AX，0100H 后 PUSH AX，最后POPF回来）


### 2.5 8086CPU的存储器与I/O组织

一. 存储器地址空间与数据存放格式
1. 地址空间
- A19-A0 给外部存储器编址，能寻址的存储器的地址空间为2^20=1MB。
- 同时也用A15-10给I/O端口编址，能寻址的I/O端口的地址空间为2^16=64KB。
- 在IBM PC机中，只运用A9-A0给I/O分配地址。地址空间为2^10=1KB。
	- 在000H-3FFH中
		- 000H-1FFH 给主板上的I/O分配地址
		- 200H-3FFH 给插线板上的I/O分配地址

2. 数据存放格式
- 数据分为字节型，字型，双字型等。
	- 对于字节型数据：在DS段中有定义：DB（字节型数据定义伪指令）   如：DB 12H，12，-12；
	- 对于字型数据：DW（字型数据定义伪指令），一般低地址单元的地址作为该字的地址。
		- 其中：子单元为偶地址的地址单元作为对准的（一个总线周期时间即可完成读写操作），为奇地址的单元作为未对准的（两个总线周期时间才能完成读写操作）。
		- 偶地址走低八位数据线（D0-D7）；奇地址走高八位数据线（D8-D15）
	- 对于双字型数据：DD

二. 存储器的分段与物理地址（PA）的形成
1. 存储器为什么要分段？
	- 2^20和2^16不对应，寻址不完。需要分段充分利用存储器的地址。
2. 怎么分段？
	- 每个逻辑段最大64KB，每个逻辑段的起始地址**必须能被16整除**。
	- 对一个逻辑段而言，它的起始地址称为段基址。
	- 逻辑地址用段地址：段内偏移地址描述。（逻辑地址不唯一，但物理地址唯一）

三. 物理地址的形成
	- PA=段地址\*16（左移一位）+段内偏移地址（段内有效地址EA）
1. 取指令操作
	- CS，IP由操作系统控制。
![|500](assets/Pasted%20image%2020220925151110.png)

2. 数据传送操作与堆栈操作。

四. 各类地址的物理信息
![|600](assets/Pasted%20image%2020220925151341.png)
- 经过汇编后，段与段之间不会重叠。可以更改段寄存器的值转化当前段。


## 第三章 8086CPU的指令系统

### 3.1 汇编语言指令

1. 名词解释
- 指令
- 指令系统：CPU能识别的所有指令的集合。
- 机器语言：指令代码语言=>编写的程序为机器语言程序，编写到计算机内能直接执行。
- 汇编语言：符号化语言=>编写的程序为汇编语言（源程序）。
- 汇编：把汇编语言源程序翻译成机器语言的过程。（反汇编）

2. 8086汇编语言指令的种类
- 指令语句：CPU能执行的语句/汇编后能翻译成二进制指令代码的语句。
- 伪指令语句：CPU不能执行的语句/汇编后不能翻译成二进制指令代码的语句（如DB）
- 宏指令语句：本身是8086指令系统没有的指令，是用户用宏指令定义伪指令定义的新的语句。

3. 语句的组成
- 标号：一旦定义就有三个属性
	- 段地址属性
	- 段内偏移地址属性（OFFSET）
	- 类型（NEAR：近程转移（默认值-1），FAR：远程转移（默认值-2）
- 助记符
- 操作数

4. 汇编语言的常数及表达式
- 常数，字符，字符串，‘？’（表明是随机的）
- 表达式：算数表达式，逻辑操作表达式，关系表达式，属性表达式

5. 变量及变量定义伪指令
![](assets/Pasted%20image%2020220928213414.png)
- DB：定义字节型变量，DW，DD，DQ，DT。
	- 变量一旦定义了，就具有了五个属性：段地址属性（SEG），段内偏移地址属性（OFFSET），类型属性（TYPE），长度属性（LENGTH），大小属性（SIZE）。
	- 在MASM.exe程序中，有一个\$（位置计数器）用于跟踪当前汇编指令所在的偏移地址。同时，\$也可以表示为常量。





# 课程评价
